<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.542">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PopModels - Surplus production models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">PopModels</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Surplus production models</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this exercise, we take the concepts we learned yesterday regarding equilibrium properties of the Schaefer surplus production model, and we attempt to apply them using whelk data.</p>
<p>Whelk data you can retrieve by downloading and importing them from the institute advice <a href="https://dt.hafogvatn.is/astand/2023/45_WHE_en.html">webpage</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>WHE_landings <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'WHE_landings.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 30 Columns: 8
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (5): species_name, latin_name, country, area, gear
dbl (2): year, landings
lgl (1): landings_type

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>WHE_assessment <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'WHE_assessment.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 19 Columns: 6
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): species_name, latin_name
dbl (4): year, high_cpue, low_cpue, cpue

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>whelk.data <span class="ot">&lt;-</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  WHE_landings <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">landings =</span> <span class="fu">sum</span>(landings))  <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">year=</span><span class="dv">2020</span>, <span class="at">landings=</span><span class="cn">NA</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(WHE_assessment) <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">YY =</span> year, <span class="at">II =</span> cpue, <span class="at">CC =</span> landings) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YY <span class="sc">&gt;</span> <span class="dv">2003</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(year)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ProductionFunction<span class="ot">&lt;-</span><span class="cf">function</span>(rr, KK, qq, <span class="at">PP0=</span>KK, CC){</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># II = CPUE data; rr, KK, qq, and PP0 are parameters</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  PP<span class="ot">&lt;-</span><span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="at">length =</span> <span class="fu">length</span>(CC)); DD<span class="ot">&lt;-</span>PP; Pred<span class="ot">&lt;-</span>PP <span class="co"># this just defines the storage vectors beforehand</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  PP[<span class="dv">1</span>]<span class="ot">&lt;-</span>PP0 <span class="co">#assigns the first year's abundance </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(CC)){ <span class="co">#then for every other year,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    DD[ii<span class="dv">-1</span>]<span class="ot">&lt;-</span> rr<span class="sc">*</span>PP[ii<span class="dv">-1</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>PP[ii<span class="dv">-1</span>]<span class="sc">/</span>KK) <span class="co"># calculate the growth of the population based on rr and KK</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    PP[ii]<span class="ot">&lt;-</span>PP[ii<span class="dv">-1</span>] <span class="sc">+</span> DD[ii<span class="dv">-1</span>] <span class="sc">-</span> CC[ii<span class="dv">-1</span>] <span class="co"># and add that growth to that year's population, remove the catch, and update population levels for next year</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  Pred <span class="ot">&lt;-</span> qq<span class="sc">*</span>PP <span class="co">#calculate the Predictions for the index of abundance by translating the model population by catchability</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Pred) <span class="co"># this function returns predictions</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#rr is intrinsic growth rate</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#KK is carrying capacity</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#qq is catchability</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#PP0 is initial population size</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#note that KK and PP0 reflect the absolute abundance level of the population, which can be </span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#difficult to detect if the data don't have much contrast </span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#(i.e., they don't go up AND down a lot over time)</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Note the scale of q, KK, and PP0 should be roughly right for nls to work. If not, try multiplying</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#or dividing by 10 or 100 or 1000</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#c(rr = 0.25, KK = 9000, qq = 0.01)</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>Whelk.nls <span class="ot">&lt;-</span> <span class="fu">nls</span>(II <span class="sc">~</span> <span class="fu">ProductionFunction</span>(<span class="at">rr=</span>rr, <span class="at">KK=</span>KK, <span class="at">qq=</span>qq, <span class="at">CC=</span>CC), </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">list</span>(<span class="at">CC =</span> whelk.data<span class="sc">$</span>CC, <span class="at">II =</span> whelk.data<span class="sc">$</span>II), </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">start =</span> <span class="fu">c</span>(<span class="at">rr =</span> <span class="fl">0.15</span>, <span class="at">KK =</span> <span class="dv">10000</span>, <span class="at">qq =</span> <span class="fl">0.00008</span>), </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxiter =</span> <span class="dv">10000</span>, <span class="at">minFactor=</span><span class="fl">0.000001</span>))</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Whelk.nls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: II ~ ProductionFunction(rr = rr, KK = KK, qq = qq, CC = CC)

Parameters:
    Estimate Std. Error t value Pr(&gt;|t|)  
rr 1.091e-01  8.831e-02   1.236   0.2356  
KK 9.827e+03  5.235e+03   1.877   0.0801 .
qq 7.328e-05  4.703e-05   1.558   0.1400  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1214 on 15 degrees of freedom

Number of iterations to convergence: 9 
Achieved convergence tolerance: 5.153e-06
  (1 observation deleted due to missingness)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>best_pars <span class="ot">&lt;-</span> <span class="fu">coef</span>(Whelk.nls) <span class="co">#extract best-fit parameters</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>best_pred <span class="ot">&lt;-</span> <span class="fu">ProductionFunction</span>(<span class="at">rr=</span>best_pars[<span class="dv">1</span>], </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">KK=</span>best_pars[<span class="dv">2</span>], </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">qq=</span>best_pars[<span class="dv">3</span>], </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">CC=</span>whelk.data<span class="sc">$</span>CC) <span class="co"># create predictions</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">YY=</span>whelk.data<span class="sc">$</span>YY, <span class="at">II =</span> whelk.data<span class="sc">$</span>II, best_pred) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(YY, best_pred)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(YY, II)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Time"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Observed (points) and Predicted (line) CPUE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Fitting_SPM_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now try changing the starting values for parameters (especially KK and PP0) to see whether they affect results. If they do, that means the data don’t carry much information, we need a better estimation method, or we need to rule out some local minima external to the modeling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Whelk.nls <span class="ot">&lt;-</span> <span class="fu">nls</span>(II <span class="sc">~</span> <span class="fu">ProductionFunction</span>(<span class="at">rr=</span>rr, <span class="at">KK=</span>KK, <span class="at">qq=</span>qq, <span class="at">CC=</span>CC), </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">list</span>(<span class="at">CC =</span> whelk.data<span class="sc">$</span>CC, <span class="at">II =</span> whelk.data<span class="sc">$</span>II), </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">start =</span> <span class="fu">c</span>(<span class="at">rr =</span> <span class="dv">1</span>, <span class="at">KK =</span> <span class="dv">5000</span>, <span class="at">qq =</span> <span class="fl">0.08</span>), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxiter =</span> <span class="dv">10000</span>, <span class="at">minFactor=</span><span class="fl">0.000001</span>))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Whelk.nls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: II ~ ProductionFunction(rr = rr, KK = KK, qq = qq, CC = CC)

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)  
rr  1.169e+00  4.838e-01   2.416   0.0289 *
KK -2.258e+03  1.593e+03  -1.417   0.1769  
qq -2.113e-04  1.312e-04  -1.610   0.1282  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.128 on 15 degrees of freedom

Number of iterations to convergence: 13 
Achieved convergence tolerance: 5.261e-06
  (1 observation deleted due to missingness)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>best_pars2 <span class="ot">&lt;-</span> <span class="fu">coef</span>(Whelk.nls) <span class="co">#extract best-fit parameters</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>best_pred2 <span class="ot">&lt;-</span> <span class="fu">ProductionFunction</span>(<span class="at">rr=</span>best_pars2[<span class="dv">1</span>], </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">KK=</span>best_pars2[<span class="dv">2</span>], </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">qq=</span>best_pars2[<span class="dv">3</span>], </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">CC=</span>whelk.data<span class="sc">$</span>CC) <span class="co"># create predictions</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">YY=</span>whelk.data<span class="sc">$</span>YY, <span class="at">II =</span> whelk.data<span class="sc">$</span>II, best_pred, best_pred2) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(YY, best_pred)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(YY, II)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Time"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Observed (points) and Predicted (lines) CPUE"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(YY, best_pred2), <span class="at">color=</span><span class="st">'red'</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Fitting_SPM_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Which do you think is closer to the real biological scenario?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>best_pars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          rr           KK           qq 
1.091162e-01 9.827211e+03 7.327566e-05 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>best_pars2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           rr            KK            qq 
 1.169129e+00 -2.258058e+03 -2.112510e-04 </code></pre>
</div>
</div>
<p>Now calculate MSY and Bmsy according to your model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#MSY = r*K / 4</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Bmsy = K / 2</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>MSY <span class="ot">&lt;-</span> best_pars[<span class="dv">1</span>]<span class="sc">*</span>best_pars[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">4</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>Bmsy <span class="ot">&lt;-</span> best_pars[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>MSY; Bmsy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     rr 
268.077 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      KK 
4913.606 </code></pre>
</div>
</div>
<p>Now, we would like to loosen the assumption that the population is starting out at carrying capacity. This adds a parameter, so makes the estimation more difficult.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ProductionFunction2<span class="ot">&lt;-</span><span class="cf">function</span>(rr, KK, qq, <span class="at">a =</span> <span class="dv">1</span>, <span class="at">CC =</span> CC){</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># II = CPUE data; rr, KK, qq, and PP0 are parameters</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  PP0 <span class="ot">&lt;-</span> a<span class="sc">*</span>KK</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  PP<span class="ot">&lt;-</span><span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="at">length =</span> <span class="fu">length</span>(CC)); DD<span class="ot">&lt;-</span>PP; Pred<span class="ot">&lt;-</span>PP <span class="co"># this just defines the storage vectors beforehand</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  PP[<span class="dv">1</span>]<span class="ot">&lt;-</span>PP0 <span class="co">#assigns the first year's abundance </span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(CC)){ <span class="co">#then for every other year,</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    DD[ii<span class="dv">-1</span>]<span class="ot">&lt;-</span> rr<span class="sc">*</span>PP[ii<span class="dv">-1</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>PP[ii<span class="dv">-1</span>]<span class="sc">/</span>KK) <span class="co"># calculate the growth of the population based on rr and KK</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    PP[ii]<span class="ot">&lt;-</span>PP[ii<span class="dv">-1</span>] <span class="sc">+</span> DD[ii<span class="dv">-1</span>] <span class="sc">-</span> CC[ii<span class="dv">-1</span>] <span class="co"># and add that growth to that year's population, remove the catch, and update population levels for next year</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  Pred <span class="ot">&lt;-</span> qq<span class="sc">*</span>PP <span class="co">#calculate the Predictions for the index of abundance by translating the model population by catchability</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Pred) <span class="co"># this function returns predictions</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ProductionFunction2</span>(<span class="at">rr =</span> <span class="fl">0.27</span>, <span class="at">KK =</span> <span class="dv">7000</span>, <span class="at">qq =</span> <span class="fl">0.006</span>, <span class="at">CC =</span> whelk.data<span class="sc">$</span>CC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 42.00000 36.82200 32.10170 29.11039 28.19853 28.31241 30.10767 31.55742
 [9] 30.60390 30.59596 32.30500 33.76041 34.44466 34.14364 34.90807 35.32956
[17] 34.73854 35.32816 35.09740</code></pre>
</div>
</div>
<p>Below, the model fitting process is written twice so that you can play around with the parameter starting values and lower and upper bounds of the second version while remembering which parameters you tried last in the first version. Can you find a solution that converges? Use your best solution to check how MSY and <span class="math inline">\(B_{MSY}\)</span> values have changed from the other version.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>Whelk.nls3<span class="fl">.1</span><span class="ot">&lt;-</span><span class="fu">nls</span>(II <span class="sc">~</span> <span class="fu">ProductionFunction2</span>(<span class="at">rr=</span>rr, <span class="at">KK=</span>KK, <span class="at">qq=</span>qq, <span class="at">a =</span> a, <span class="at">CC =</span> CC), </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">algorithm =</span> <span class="st">'port'</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">list</span>(<span class="at">CC =</span> whelk.data<span class="sc">$</span>CC, <span class="at">II =</span> whelk.data<span class="sc">$</span>II), </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">start =</span> <span class="fu">c</span>(<span class="at">rr =</span> <span class="fl">0.15</span>, <span class="at">KK =</span> <span class="dv">10000</span>, <span class="at">qq =</span> <span class="fl">0.00008</span>, <span class="at">a =</span> <span class="fl">0.8</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">lower =</span> <span class="fu">c</span>(<span class="at">rr =</span> <span class="fl">0.01</span>, <span class="at">KK =</span> <span class="dv">1000</span>, <span class="at">qq =</span> <span class="fl">0.000001</span>, <span class="at">a =</span> <span class="fl">0.1</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">upper =</span> <span class="fu">c</span>(<span class="at">rr =</span> <span class="dv">1</span>, <span class="at">KK =</span> <span class="dv">30000</span>, <span class="at">qq =</span> <span class="fl">0.1</span>, <span class="at">a =</span> <span class="dv">1</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxiter =</span> <span class="dv">100000</span>, <span class="at">minFactor=</span><span class="fl">0.000001</span>), </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">trace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  0:    0.13018275: 0.150000  10000.0 8.00000e-05 0.800000
  1:    0.11789722: 0.131131  9953.59 8.08475e-05 0.823517
  2:    0.11095491: 0.112741  9950.17 8.26395e-05 0.846349
  3:    0.10931601: 0.0969817  10088.5 8.61790e-05 0.827417
  4:    0.10899659: 0.0968142  10244.3 8.84597e-05 0.792043
  5:    0.10882289: 0.0960943  10374.5 9.01341e-05 0.766726
  6:    0.10868635: 0.0951602  10542.4 9.15364e-05 0.741283
  7:    0.10857393: 0.0953840  10546.1 9.25985e-05 0.734648
  8:    0.10832050: 0.0917580  10870.3 9.68881e-05 0.685841
  9:    0.10792061: 0.0912533  11249.4 0.000100948 0.637642
 10:    0.10764554: 0.0908543  11570.1 0.000101820 0.613598
 11:    0.10749593: 0.0905338  11692.2 0.000103705 0.599633
 12:    0.10734488: 0.0907260  11881.3 0.000106264 0.577229
 13:    0.10727095: 0.0910519  11958.9 0.000107303 0.568927
 14:    0.10721481: 0.0912283  12034.5 0.000108265 0.560843
 15:    0.10707645: 0.0908617  12413.1 0.000111036 0.530377
 16:    0.10688654: 0.0905583  12860.6 0.000113277 0.502368
 17:    0.10675009: 0.0907081  13060.8 0.000114402 0.491013
 18:    0.10667455: 0.0905862  13270.1 0.000115506 0.479212
 19:    0.10661472: 0.0905528  13446.0 0.000116237 0.470122
 20:    0.10652238: 0.0900468  13825.8 0.000117256 0.452883
 21:    0.10633946: 0.0874745  14934.5 0.000115889 0.420587
 22:    0.10623247: 0.0878625  15340.8 0.000119328 0.399999
 23:    0.10610173: 0.0875922  15743.7 0.000120173 0.387723
 24:    0.10603215: 0.0874024  16077.7 0.000120913 0.377690
 25:    0.10597843: 0.0872476  16362.1 0.000121489 0.369596
 26:    0.10593152: 0.0870656  16641.3 0.000121974 0.362084
 27:    0.10588604: 0.0863275  17295.1 0.000122591 0.346198
 28:    0.10578375: 0.0862696  17692.0 0.000123302 0.336998
 29:    0.10573377: 0.0861530  18035.3 0.000123877 0.329262
 30:    0.10569404: 0.0860411  18328.6 0.000124304 0.323020
 31:    0.10566019: 0.0859194  18601.4 0.000124657 0.317471
 32:    0.10561563: 0.0855296  19106.0 0.000125050 0.307975
 33:    0.10556153: 0.0854327  19503.0 0.000125748 0.300483
 34:    0.10554211: 0.0848199  20309.9 0.000126012 0.287301
 35:    0.10544676: 0.0847914  20738.0 0.000126520 0.280698
 36:    0.10542576: 0.0844136  21571.4 0.000127537 0.267911
 37:    0.10534982: 0.0843753  21832.9 0.000127412 0.265018
 38:    0.10533886: 0.0840219  22702.1 0.000128315 0.253111
 39:    0.10525927: 0.0837474  23534.0 0.000128780 0.243410
 40:    0.10521957: 0.0837716  23656.4 0.000128650 0.242455
 41:    0.10521153: 0.0838043  23773.3 0.000128834 0.240972
 42:    0.10519404: 0.0836752  24068.5 0.000128952 0.237774
 43:    0.10517141: 0.0834977  24465.2 0.000129108 0.233635
 44:    0.10514687: 0.0833343  24901.1 0.000129292 0.229231
 45:    0.10512439: 0.0832286  25288.0 0.000129486 0.225427
 46:    0.10510492: 0.0831494  25640.9 0.000129671 0.222036
 47:    0.10508768: 0.0830831  25965.6 0.000129840 0.218999
 48:    0.10506977: 0.0829957  26327.6 0.000130000 0.215722
 49:    0.10505861: 0.0830389  26511.1 0.000130352 0.213884
 50:    0.10504111: 0.0830056  26888.6 0.000130600 0.210484
 51:    0.10502056: 0.0826460  27659.1 0.000130473 0.204467
 52:    0.10498773: 0.0825484  28179.3 0.000130657 0.200496
 53:    0.10496772: 0.0824862  28623.4 0.000130865 0.197120
 54:    0.10495140: 0.0824268  29008.1 0.000131024 0.194301
 55:    0.10494605: 0.0824738  30000.0 0.000131917 0.186680
 56:    0.10491037: 0.0827561  30000.0 0.000132272 0.186506
 57:    0.10491027: 0.0828966  30000.0 0.000132470 0.186269
 58:    0.10491026: 0.0829393  30000.0 0.000132527 0.186200
 59:    0.10491026: 0.0829528  30000.0 0.000132545 0.186178
 60:    0.10491026: 0.0829570  30000.0 0.000132551 0.186171
 61:    0.10491026: 0.0829584  30000.0 0.000132552 0.186169</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Whelk.nls3<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: II ~ ProductionFunction2(rr = rr, KK = KK, qq = qq, a = a, CC = CC)

Parameters:
    Estimate Std. Error t value Pr(&gt;|t|)
rr 8.296e-02  3.329e-01   0.249    0.807
KK 3.000e+04  9.626e+05   0.031    0.976
qq 1.326e-04  1.216e-04   1.090    0.294
a  1.862e-01  6.135e+00   0.030    0.976

Residual standard error: 0.1224 on 14 degrees of freedom

Algorithm "port", convergence message: relative convergence (4)
  (1 observation deleted due to missingness)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Whelk.nls3<span class="fl">.2</span><span class="ot">&lt;-</span><span class="fu">nls</span>(II <span class="sc">~</span> <span class="fu">ProductionFunction2</span>(<span class="at">rr=</span>rr, <span class="at">KK=</span>KK, <span class="at">qq=</span>qq, <span class="at">a =</span> a, <span class="at">CC =</span> CC), </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">algorithm =</span> <span class="st">'port'</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">list</span>(<span class="at">CC =</span> whelk.data<span class="sc">$</span>CC, <span class="at">II =</span> whelk.data<span class="sc">$</span>II), </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">start =</span> <span class="fu">c</span>(<span class="at">rr =</span> <span class="dv">1</span>, <span class="at">KK =</span> <span class="dv">5000</span>, <span class="at">qq =</span> <span class="fl">0.08</span>, <span class="at">a =</span> <span class="fl">0.8</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">lower =</span> <span class="fu">c</span>(<span class="at">rr =</span> <span class="fl">0.01</span>, <span class="at">KK =</span> <span class="dv">1000</span>, <span class="at">qq =</span> <span class="fl">0.000001</span>, <span class="at">a =</span> <span class="fl">0.1</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">upper =</span> <span class="fu">c</span>(<span class="at">rr =</span> <span class="dv">1</span>, <span class="at">KK =</span> <span class="dv">30000</span>, <span class="at">qq =</span> <span class="fl">0.1</span>, <span class="at">a =</span> <span class="dv">1</span>),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxiter =</span> <span class="dv">100000</span>, <span class="at">minFactor=</span><span class="fl">0.000001</span>), </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">trace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  0:     1179600.1:  1.00000  5000.00 0.0800000 0.800000
  1:     150833.12: 0.694538  3389.37 0.0506772 0.770942
  2:     744.77650: 0.751045  3124.63 0.00406267 0.790542
  3:     2.6515836: 0.709914  3271.14 1.00000e-06 0.811514
  4:    0.36759644: 0.819729  3669.24 0.000204489 0.852355
  5:    0.22958799: 0.920483  4010.72 0.000136196 0.931015
  6:    0.20127242:  1.00000  4414.89 0.000137295 0.988022
  7:    0.19489382:  1.00000  4964.49 0.000108243  1.00000
  8:    0.17959837:  1.00000  5518.37 0.000101845  1.00000
  9:    0.17475801:  1.00000  6125.00 9.05372e-05  1.00000
 10:    0.17283314:  1.00000  7395.23 7.16580e-05  1.00000
 11:    0.16483495:  1.00000  8039.81 6.84380e-05  1.00000
 12:    0.16300073:  1.00000  9310.04 5.75298e-05  1.00000
 13:    0.15933608:  1.00000  10580.3 5.09345e-05  1.00000
 14:    0.15727725:  1.00000  11850.5 4.54360e-05  1.00000
 15:    0.15568814:  1.00000  13120.7 4.10296e-05  1.00000
 16:    0.15446627:  1.00000  14391.0 3.73903e-05  1.00000
 17:    0.15349120:  1.00000  15661.2 3.43395e-05  1.00000
 18:    0.15269463:  1.00000  16931.4 3.17458e-05  1.00000
 19:    0.15203103:  1.00000  18201.6 2.95142e-05  1.00000
 20:    0.15146930:  1.00000  19471.9 2.75743e-05  1.00000
 21:    0.15143138:  1.00000  22166.7 2.38160e-05  1.00000
 22:    0.15013237:  1.00000  23514.0 2.28131e-05  1.00000
 23:    0.14981298:  1.00000  24861.4 2.15452e-05  1.00000
 24:    0.14963470:  1.00000  25546.1 2.10113e-05  1.00000
 25:    0.14949845:  1.00000  26191.4 2.04882e-05  1.00000
 26:    0.14933902:  1.00000  27003.7 1.98573e-05  1.00000
 27:    0.14922540:  1.00000  30000.0 1.76459e-05  1.00000
 28:    0.14882335:  1.00000  30000.0 1.78702e-05  1.00000
 29:    0.14882334:  1.00000  30000.0 1.78714e-05  1.00000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Whelk.nls3<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: II ~ ProductionFunction2(rr = rr, KK = KK, qq = qq, a = a, CC = CC)

Parameters:
    Estimate Std. Error t value Pr(&gt;|t|)   
rr 1.000e+00  7.861e+00   0.127  0.90058   
KK 3.000e+04  2.406e+05   0.125  0.90254   
qq 1.787e-05  1.442e-04   0.124  0.90314   
a  1.000e+00  2.961e-01   3.377  0.00452 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1458 on 14 degrees of freedom

Algorithm "port", convergence message: X-convergence (3)
  (1 observation deleted due to missingness)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># insert either Whelk.nls3.1 or Whelk.nls3.2 into the coef() function below, </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># whichever one you found as the best model you could come up with.</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>best_pars3 <span class="ot">&lt;-</span> <span class="fu">coef</span>(Whelk.nls3<span class="fl">.1</span>) <span class="co">#extract best-fit parameters</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>best_pred3 <span class="ot">&lt;-</span> <span class="fu">ProductionFunction2</span>(<span class="at">rr=</span>best_pars3[<span class="dv">1</span>], </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">KK=</span>best_pars3[<span class="dv">2</span>], </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                                <span class="at">qq=</span>best_pars3[<span class="dv">3</span>], </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                                <span class="at">a=</span>best_pars3[<span class="dv">4</span>], </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">CC=</span>whelk.data<span class="sc">$</span>CC) <span class="co"># create predictions</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">YY=</span>whelk.data<span class="sc">$</span>YY, <span class="at">II =</span> whelk.data<span class="sc">$</span>II, best_pred3) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(YY, best_pred)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(YY, II)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Time"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Observed (points) and Predicted (lines) CPUE"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(YY, best_pred2), <span class="at">color=</span><span class="st">'red'</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Fitting_SPM_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>MSY <span class="ot">&lt;-</span> best_pars3[<span class="dv">1</span>]<span class="sc">*</span>best_pars3[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">4</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>Bmsy <span class="ot">&lt;-</span> best_pars3[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>MSY; Bmsy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      rr 
622.1877 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   KK 
15000 </code></pre>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>